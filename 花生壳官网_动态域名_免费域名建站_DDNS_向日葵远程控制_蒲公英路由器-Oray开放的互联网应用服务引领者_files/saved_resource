(function(b){var a=navigator.userAgent;b.window=function(e){var d=this;this.opts=b.extend({},b.window.defaults,e);this.fixIE=(undefined!==typeof(document.body.style.maxHeight));this.id=Math.random();if(!this.opts.applyTo){return}var c=b(this.opts.applyTo).css({zIndex:8001});this.dialog={container:c,header:c.find(".window-header"),body:c.find(".window-body"),footer:c.find(".window-footer")};this.bh=b("#fix-height");if(!this.bh.size()){this.bh=b("<div>").attr("id","fix-height").css({position:"absolute",height:"100%",width:1,left:-100,top:0}).appendTo(document.body)}this.fn={show:this.opts.show,close:this.opts.close};if(this.fixIE){this.iframe=b('<iframe src="javascript:false;">').css({opacity:0,position:"absolute",zIndex:1000,width:"100%",top:0,left:0}).hide().appendTo("body")}if(this.opts.center){this.opts.draggable=false}if(this.opts.draggable&&b.fn.drag){this.dialog.container.drag(this.opts.drag)}if(b(".mask").size()){this.mask=b(".mask").hide()}else{this.mask=b('<div class="mask">').css({zIndex:8000}).appendTo(document.body).hide()}this.dialog.container.hide().appendTo(document.body);this.dialog.container.find("."+this.opts.closeCls).on("click",function(f){f.preventDefault();d.close()});this.dialog.container.css({height:this.opts.height,width:this.opts.width});return this};b.window.prototype={show:function(){if(this.iframe){this.iframe.show()}this.mask.show();this.resizeMask();this.dialog.container.show();this.center();if(b.isFunction(this.fn.show)){this.fn.show.apply(this,[this.dialog])}this.bindEvents()},close:function(){if(this.iframe){this.iframe.hide()}this.mask.hide();this.dialog.container.hide();if(b.isFunction(this.fn.close)){this.fn.close.apply(this,[this.dialog])}this.unbindEvents();var c=this;if(this.opts.destroy){c.destroy()}},resizeMask:function(){if(this.fixIE){var c=Math.max(document.body.offsetHeight,this.bh.height());var d=document.body.offsetWidth;this.mask.css({height:c,width:d});if(this.iframe){this.iframe.css({height:c,width:d})}}else{this.mask.css("position","fixed")}},center:function(){var c=(document.body.offsetWidth-b(this.dialog.container).width())/2;var d=((Math.min(this.bh.height(),document.documentElement.offsetHeight)-this.dialog.container.height())/2+Math.max(document.documentElement.scrollTop,document.body.scrollTop));this.dialog.container.css({left:c,top:d});if(this.dialog.container.offset().top<0){this.dialog.container.css({top:"0px"})}},esc:function(d){var c=this;var f=window.event||d;if(f.keyCode==27||f.which==27){c.close();if(c.opts.destroy){c.destroy()}}},bindEvents:function(){var c=this;b(document).bind("keydown click",function(f){if(f.type=="click"){if(c.opts.blankCls){var d=b(f.target);if(d.closest(c.opts.blankCls).size()==0&&c.dialog.container.is(":visible")){c.close()}}}else{c.esc(f)}});if(this.opts.center){b(window).bind("resize scroll",function(){c.center()})}if(this.fixIE){b(window).bind("resize",function(){c.resizeMask()})}},unbindEvents:function(){var c=this;b(document).unbind("keydown click",function(f){if(f.type=="click"){if(c.opts.blankCls){var d=b(f.target);if(d.closest(c.opts.blankCls).size()==0&&c.dialog.container.is(":visible")){c.close()}}}else{c.esc(f)}});if(this.opts.center){b(window).unbind("resize scroll",function(){c.center()})}if(this.fixIE){b(window).unbind("resize",function(){c.resizeMask()})}},destroy:function(){if(this.iframe){this.iframe.remove()}this.mask.remove();this.bh.remove();this.dialog.container.remove();return null},find:function(c){return this.dialog.container.find(c)}};b.fn.window=function(c){if(!this.length){c&&c.debug&&d.console&&console.warn("nothing selected, can't open window, returning nothing");return}var d=b.data(this[0],"window");if(d){return d}d=new b.window(b.extend(c,{applyTo:this[0],id:this[0].id}));b.data(this[0],"window",d);return d};b.window.defaults={id:"window",width:false,height:false,closeCls:"close",blankCls:null,draggable:false,center:false,destroy:false,show:null,close:null}})(jQuery);
